--Очистка БД, перед созданием новой структуры БД:
DROP TABLE IF EXISTS
USERS,
FILMS,
FILMS_GENRES,
FRIENDS,
LIKES,
GENRES,
RATINGS;

-- Создание структуры БД:
-- Создание таблицы GENRES:
CREATE TABLE IF NOT EXISTS GENRES (
	GENRE_ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	GENRE_NAME CHARACTER VARYING(50) NOT NULL
);

-- Создание таблицы RATINGS:
CREATE TABLE IF NOT EXISTS RATINGS (
	RATING_ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	RATING_NAME CHARACTER VARYING(10) NOT NULL,
	RATING_DESC CHARACTER VARYING(100) NOT NULL
);

-- Создание таблицы USERS:
CREATE TABLE IF NOT EXISTS USERS (
	USER_ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	NAME CHARACTER VARYING(100),
	LOGIN CHARACTER VARYING(100) NOT NULL,
	EMAIL CHARACTER VARYING NOT NULL,
	BIRTHDAY DATE NOT NULL
);

-- Создание таблицы FILMS:
CREATE TABLE IF NOT EXISTS FILMS (
	FILM_ID INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	NAME CHARACTER VARYING(100) NOT NULL,
	DESCRIPTION CHARACTER VARYING(200) NOT NULL,
	RELEASE_DATE DATE NOT NULL,
	DURATION INTEGER NOT NULL,
	RATING_ID INTEGER NOT NULL,
	CONSTRAINT FILMS_FK FOREIGN KEY (RATING_ID) REFERENCES RATINGS(RATING_ID) ON delete CASCADE ON update CASCADE
);

-- Создание таблицы FILMS_GENRES:
CREATE TABLE IF NOT EXISTS FILMS_GENRES (
	GENRE_ID INTEGER NOT NULL,
	FILM_ID INTEGER NOT NULL,
	CONSTRAINT FILMS_GENRES_PK PRIMARY KEY (GENRE_ID,FILM_ID),
	CONSTRAINT FILMS_GENRES_FK_1 FOREIGN KEY (GENRE_ID) REFERENCES GENRES(GENRE_ID) ON delete CASCADE ON update CASCADE,
	CONSTRAINT FILMS_GENRES_FK_2 FOREIGN KEY (FILM_ID) REFERENCES FILMS(FILM_ID) ON delete CASCADE ON update CASCADE
);

-- Создание таблицы FRIENDS:
CREATE TABLE IF NOT EXISTS FRIENDS (
	USER_ID INTEGER NOT NULL,
	FRIEND_ID INTEGER NOT NULL,
	CONSTRAINT FRIENDS_PK PRIMARY KEY (FRIEND_ID,USER_ID),
	CONSTRAINT FRIENDS_FK_1 FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID) ON delete CASCADE ON update CASCADE,
	CONSTRAINT FRIENDS_FK_2 FOREIGN KEY (FRIEND_ID) REFERENCES USERS(USER_ID) ON delete CASCADE ON update CASCADE
);

-- Создание таблицы LIKES:
CREATE TABLE IF NOT EXISTS LIKES (
	FILM_ID INTEGER NOT NULL,
	USER_ID INTEGER NOT NULL,
	CONSTRAINT LIKES_PK PRIMARY KEY (FILM_ID,USER_ID),
	CONSTRAINT LIKES_FK_1 FOREIGN KEY (USER_ID) REFERENCES USERS(USER_ID) ON delete CASCADE ON update CASCADE,
	CONSTRAINT LIKES_FK_2 FOREIGN KEY (FILM_ID) REFERENCES FILMS(FILM_ID) ON delete CASCADE ON update CASCADE
);
